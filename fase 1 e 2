#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define altura 10
#define largura 10

#define altura2 20
#define largura2 20



		//Funcao para imprimir o mapa
	void printmap(char mapa[altura][largura], int px, int py){
			 system("cls");
			 
	    int i, j;
	
	    for (i = 0; i < altura; i++) {
	        for (j = 0; j < largura; j++) {
	            if (i == py && j == px) {
	                printf("&");
	            } else {
	                printf("%c", mapa[i][j]);
	            }
	        }
	        printf("\n");
	    }
	}
		//Funcao para imprimir o segundo mapa
	void printmap2(char mapa2[altura2][largura2], int px2, int py2){
			 system("cls");
	    int i2, j2;
	
	    for (i2 = 0; i2 < altura2; i2++) {
	        for (j2 = 0; j2 < largura2; j2++) {
	            if (i2 == py2 && j2 == px2) {
	                printf("&");
	            } else {
	                printf("%c", mapa2[i2][j2]);
	            }
	        }
	        printf("\n");
	    }
	}

//---------------------------------------------------------------------------------------------------------------------------------------------
	int main(int argc, char *argv[]) {
			//menu principal:
		
		int numero;
		
		printf("\n\n\t\t\t\t\tMENU PRINCIPAL:\n\n\n\t\t\t\t\t1-JOGAR\n\n\n\t\t\t\t\t2-TUTORIAL\n\n\n\t\t\t\t\t3-SAIR\n");
		scanf("%d", &numero);
		
		if(numero == 1){		
			//fase 1
		system("cls");
			//iniciar o jogador na posicao
			int x = 1;
			int y = 1;
			//variavel para representar a chave
			int pegouChave = 0;
			//variavel para representar a porta
			int portaAberta = 0;
			//Desenho do mapa 
			char mapa [altura][largura] = {
				"**********",
				"* *      *",
				"*   *** D*",
				"***  ** **",
				"***  *****",
				"***  ** **",
				"***       ",
				"***  ** **",
				"***  **@**",
				"**********"	
			};
			//Desenho do mapa segunda fase
				char mapa2[altura2][largura2] = {
					
				"********************",
				"*                 D*",
				"*  ******** *****##*",
				"*  ******** *****  *",
				"*           #      *",
				"*** *************  *",
				"*** *************  *",
				"*** *************  *",
				"*** *************  *",
				"*          *       *",
				"*          *       *",
				"*          *       *",
				"*          *       *",
				"*          *       *",
				"*          *       *",
				"*          *       *",
				"*          *       *",
				"*          *       *",
				"*O         *      @*",
				"********************"
				};
				
				srand(time(0));
				int m1 = 12;
				int o1 = 14;
				char move_m;
				char tab[largura2][altura2];
				int m2;
				int o2;
				int a2;
				int l2;
				
			while(numero == 1){
				system("cls");
			//printando o mapa e a localizacao do personagem
				printmap(mapa, x, y);
			
			//criando movimento
				char move = getch();
			
				switch(move){
					case'w':
						if(y > 1 && mapa[y-1][x] != '*' && mapa[y-1][x] != 'D') 
							y--;
						break;
						
					case's':
						if(y<altura - 2 && mapa[y + 1][x] != '*' && mapa[y+1][x] != 'D')
							y++;
						break;
						
					case'a':
						if(x > 1 && mapa[y][x-1] != '*' && mapa[y][x + 1] != 'D')
							x--;
						break;
						
					case 'd':
						if(x<largura - 2 && mapa[y][x+1] != '*' && mapa[y][x+1] != 'D')
							x++;
						break;	
			//pegar a chave
				case 'i':
					if (mapa[y][x] == '@') 
	            		pegouChave = 1;
	            		mapa[y][x] = ' ';       
	            	break;		
			}//abertura da porta
			if(pegouChave == 1){
				if( move == 'w' && mapa[y-1][x] == 'D'){
					portaAberta = 1;
					mapa[y - 1][x] = '=';
				}else if(move == 's' && mapa[y+1][x] == 'D'){
					portaAberta = 1;
					mapa[y + 1][x] = '=';
				}else if(move == 'a' && mapa[y][x-1] == 'D'){
					portaAberta = 1;
					mapa[y][x- 1] = '=';
					
				}else if(move == 'd' && mapa[y][x+1] == 'D'){
					portaAberta = 1;
					mapa[y][x + 1] = '=';
			}
		}
			//finalizacao da primeira fase
			if(portaAberta && mapa[y][x] == '='){
				system("cls");
				printf("\t\t\t\t\tParabens!!! Voce concluiu a primeira fase!\n");
				sleep(1);
			break;
			}
		}
//---------------------------------------------------------------------------------------------------------------------------------------------	
			//fase 2
				system("cls");
				
				int resposta;
				sleep(1);
				printf("Voce deseja ir para a segunda fase?(1-sim/2-nao)");
				scanf("%d", &resposta);
				
				if(resposta == 1){
					system("cls");
					printf("\t\t\t\t\tCarregando a segunda fase...");
					sleep(2);
			}
			//iniciar a posicao do jogador
				int x2 = 1;
				int y2 = 1;
				//variavel para representar a chave
				int pegouChave2 = 0;
				//variavel para representar a porta
				int portaAberta2 = 0;
				//variavel para representar o botao
				int botao = 0;
				//variavel do espinho
				int espinho = 3;
			
				while(resposta == 1){
					system("cls");	
					//printando o mapa
					printmap2(mapa2,x2,y2);
				
					//criando movimento
					char move2 = getch();
			
					switch(move2){
						case'w':
							if(y2 > 1 && mapa2[y2-1][x2] != '*' && mapa2[y2-1][x2] != 'D') 
							y2--;
							break;
						case's':
							if(y2<altura2 - 2 && mapa2[y2 + 1][x2] != '*' && mapa2[y2+1][x2] != 'D')
							y2++;
							break;
						case'a':
							if(x2 > 1 && mapa2[y2][x2-1] != '*' && mapa2[y2][x2 + 1] != 'D')
							x2--;
							break;
						case 'd':
							if(x2<largura2 - 2 && mapa2[y2][x2+1] != '*' && mapa2[y2][x2+1] != 'D')
							x2++;
							break;	
						//pegar a chave
						case 'i':
						if (mapa2[y2][x2] == '@'){
							pegouChave2 = 1;
			            	mapa2[y2][x2] = ' ';
						}else if(mapa2[y2][x2] == 'O'){
							botao = 1;
							mapa2[12][11] = ' ';
						}      
			        break;
			}
				//abertura da porta
				if(pegouChave2 == 1){
					if( move2 == 'w' && mapa2[y2-1][x2] == 'D'){
						portaAberta2 = 1;
						mapa2[y2 - 1][x2] = '=';
					}else if(move2 == 's' && mapa2[y2+1][x2] == 'D'){
						portaAberta2 = 1;
						mapa2[y2 + 1][x2] = '=';
					}else if(move2 == 'a' && mapa2[y2][x2-1] == 'D'){
						portaAberta2 = 1;
						mapa2[y2][x2- 1] = '=';
						
					}else if(move2 == 'd' && mapa2[y2][x2+1] == 'D'){
						portaAberta2 = 1;
						mapa2[y2][x2 + 1] = '=';
					}
				}	
				//espinho
				if(mapa2[15][12] == '&'){
					espinho--;
					if(espinho == 0){
						return (0);
					}	
				}					
					if(x2==m2 && y2==o2){
						system("cls");
						printf("O monstro matou vc :(\n");
						break;
					}
				system("cls");
			
				//Finalizacao da segunda fase
				if(portaAberta2 && mapa2[y2][x2] == '='){
					system("cls");
					printf("\t\t\t\t\tParabens!!! Voce concluiu a segunda fase!\n");
					sleep(1);
				break;
				}
					system("cls");
				}	
		}else if (numero == 2){
		//Tutorial
				system("cls");
				printf("Bem vindos ao tutorial!\nO jogo conta uma aventura onde o objetivo do jogador consiste em passar de 3 fases\n\n");
				printf("Sistema de vitoria:\npara ganhar o jogador deve se movimentar esquivando-se de espinhos,monstros e obstaculos para pegar uma chave e abrir a porta\n\n");
				printf("Sistema de derrota:\ncaso o monstro toque no jogador ou caia em um espinho a fase sera reniciada (se reniciada 3 vezes o jogador perde e o jogo volta ao menu principal)\n\n");
				printf("Controles:\nW:cima\nA:esquerda\nS:baixo\nD:direita\n\n");
				printf("Simbologia:\n");
				printf("&:simbolo que representa o jogador\n*:simbolo que representa paredes (o jogador nao consegue atravessa-las)\n");
				printf("@:simbolo que representa a chave para abrir a porta e finalizar a chave\nD:simbolo que representa uma porta fechada\n");
				printf("=:simbolo que representa uma porta aberta\n0:simbolo que representa um botao interativo\n#:simbolo que representa um espinho\n");
				printf(">:simbolo que representa um teletransporte\nX:simbolo que representa o monstro nivel 1\nV:simbolo que representa o monstro nivel 2");
				
		}else if (numero == 3){
		//Encerramento do jogo
		printf("Jogo encerrado, ate a proxima ;)");
		}
	
	}
	return 0;
}
